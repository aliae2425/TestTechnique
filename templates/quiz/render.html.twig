{% extends 'base.html.twig' %}

{% block title %}Quiz - {{ quiz.Titre }}{% endblock %}

{% block body %}
    {% set isExam = quiz.Mode == 'Exam' %}
    
    <div class="fixed inset-0 overflow-hidden flex flex-col pt-16 bg-slate-50 transition-colors duration-500" 
         data-controller="quiz"
         data-quiz-mode-value="{{ quiz.Mode }}">
        
        <div class="flex-1 flex flex-row-reverse items-center w-full max-w-7xl mx-auto p-4 gap-6 h-full overflow-hidden relative z-10">
            
            {# Sidebar Navigation (Cells) #}
            <div class="hidden md:flex flex-col justify-center gap-3 pl-2 h-[65vh] overflow-y-auto w-16 shrink-0 no-scrollbar py-4">
                {% for question in questions %}
                    <button type="button"
                            data-action="click->quiz#jumpToQuestion"
                            data-index="{{ loop.index0 }}"
                            class="w-3 h-12 rounded-full bg-slate-200 border border-slate-300 transition-all duration-300 hover:w-4 hover:bg-slate-300 group relative"
                            data-quiz-target="cell"
                            title="Question {{ loop.index }}">
                    </button>
                {% endfor %}
            </div>

            {# Main Card Container #}
            <twig:Card class="flex-1 relative h-[65vh] overflow-hidden flex flex-col">
                 
                 <twig:Card:Header>
                    <twig:Card:Title class="text-3xl font-bold text-slate-800 mb-2 drop-shadow-sm">{{ quiz.Titre }}</twig:Card:Title>
                    <twig:Card:Description>
                        <span class="inline-block px-4 py-1 rounded-full text-sm font-medium {{ isExam ? 'bg-sky-100 text-sky-800 border border-sky-200' : 'bg-indigo-100 text-indigo-800 border border-indigo-200' }}">
                            Mode {{ quiz.type }}
                        </span>
                    </twig:Card:Description>
                 </twig:Card:Header>

                 <twig:Card:Content>
                    <form action="{{ path('app_quiz_start', {id: quiz.id}) }}" method="POST" data-turbo="false">
                        
                        {# Questions Container #}
                        <div class="flex-1 overflow-y-auto no-scrollbar pr-2 relative">
                            {% for question in questions %}
                                <div class="hidden h-full flex flex-col animate-in fade-in slide-in-from-right-4 duration-300" 
                                     data-quiz-target="question" 
                                     id="q_{{ question.id }}">  
                                    
                                    {# CONTENT CARD #}
                                    <div class="p-6 md:p-8 flex flex-col md:flex-row gap-8">
                                        
                                        <div class="flex-1">
                                            <h2 class="text-xl md:text-2xl font-semibold text-slate-800 mb-6 leading-snug">
                                                {{ question.titled }}
                                            </h2>

                                            {% if question.image %}
                                                <div class="mb-6 rounded-xl overflow-hidden shadow-md border border-slate-200 w-full max-w-sm">
                                                    <img src="{{ asset('uploads/images/questions/' ~ question.image) }}" alt="Image" class="w-full max-h-60 object-contain bg-white">
                                                </div>
                                            {% endif %}
                                            
                                            {% if question.Description %}
                                                <div class="mb-6 text-slate-600 prose prose-sm max-w-none bg-white p-4">
                                                    {{ question.Description|raw }}
                                                </div>
                                            {% endif %}
                                        </div>

                                        <div class="flex-1 flex flex-col gap-4 min-w-[300px]">
                                            {# Answers in a grid #}
                                            <div class="grid gap-3">
                                                {% for answer in question.Reponses %}
                                                    <label class="relative flex items-start p-4 rounded-xl border-2 border-transparent bg-white hover:bg-slate-50 transition-all cursor-pointer shadow-sm group ring-1 ring-slate-200">
                                                        <div class="flex items-center h-5">
                                                            <input type="radio" 
                                                                name="q_{{ question.id }}[]" 
                                                                value="{{ answer.id }}"
                                                                data-action="change->quiz#validate"
                                                                data-is-correct="{{ answer.isCorrect ? 'true' : 'false' }}"
                                                                class="w-5 h-5 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500 bg-white mt-0.5">
                                                        </div>
                                                        
                                                        <div class="ml-4 flex-1">
                                                            <span class="text-base font-medium text-slate-700 group-hover:text-slate-900 select-none block">
                                                                {{ answer.text }}
                                                            </span>

                                                            {% if not isExam and answer.feedback %}
                                                                <div class="hidden mt-2 text-sm font-medium opacity-90" data-quiz-target="feedback">
                                                                    {{ answer.feedback }}
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                    </label>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        {# Footer Navigation #}
                        <div class="mt-8 flex justify-between items-center shrink-0">
                            <button type="button" 
                                    class="px-8 py-3 rounded-xl border border-slate-300 bg-white text-slate-700 hover:bg-slate-50 transition-all font-semibold invisible"
                                    data-action="quiz#previous"
                                    data-quiz-target="prevButton">
                                ← Précédent
                            </button>

                            <button type="button" 
                                    class="px-8 py-3 rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 shadow-lg shadow-indigo-900/20 transition-all font-bold"
                                    data-action="quiz#next"
                                    data-quiz-target="nextButton">
                                Suivant →
                            </button>

                            <button type="submit" 
                                    class="hidden px-8 py-3 rounded-xl bg-green-600 text-white hover:bg-green-500 shadow-lg shadow-green-900/20 transition-all font-bold"
                                    data-quiz-target="submitButton">
                                Terminer
                            </button>
                        </div>

                    </form>
                 </twig:Card:Content>
            </twig:Card>
        </div>
    </div>
{% endblock %}
