{% extends 'user/board/Profile.html.twig' %}

{% block title %}Profil Entreprise - {{ company.Name }}{% endblock %}

{% block main_content %}
    {{ form_start(form, {'attr': {'class': 'space-y-6', 'novalidate': 'novalidate'}}) }}
    
    {% for message in app.flashes('success') %}
        <div class="p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400" role="alert">
            <span class="font-medium">Succès !</span> {{ message }}
        </div>
    {% endfor %}

    {% if not form.vars.valid %}
        <div class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
            <span class="font-medium">Erreur !</span> Veuillez corriger les erreurs dans le formulaire.
            {{ form_errors(form) }}
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const errors = document.querySelectorAll('.text-red-500, .text-danger, .invalid-feedback, ul li');
                for (const error of errors) {
                    const tabPane = error.closest('[role="tabpanel"]');
                    if (tabPane) {
                        changeTab(tabPane.id);
                        break;
                    }
                }
            });
        </script>
    {% endif %}

    <!-- Tabs Header -->
    <div class="border-b border-gray-200 dark:border-gray-700 mb-6">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="companyTab" role="tablist">
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 active text-cyan-600 border-cyan-600" id="general-tab" type="button" role="tab" aria-controls="general" aria-selected="true" onclick="changeTab('general')">Informations générales</button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" id="description-tab" type="button" role="tab" aria-controls="description" aria-selected="false" onclick="changeTab('description')">Description</button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" id="users-tab" type="button" role="tab" aria-controls="users" aria-selected="false" onclick="changeTab('users')">Utilisateurs</button>
            </li>
        </ul>
    </div>

    <div id="companyTabContent" class="p-4 rounded-lg bg-white shadow-sm border border-slate-100" >
        {# TAB 1: Informations Générales #}
        <div id="general" role="tabpanel" aria-labelledby="general-tab">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                
                <div class="space-y-2">
                    {{ form_row(form.Name, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50'}}) }}
                </div>
                <div class="space-y-2">
                    {{ form_row(form.Contry, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50'}}) }}
                </div>
                <div class="space-y-2">
                    {{ form_row(form.ActivitySector, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50'}}) }}
                </div>
                <div class="space-y-2">
                    {{ form_row(form.Size, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50'}}) }}
                </div>
            </div>

            <h3 class="text-lg font-medium text-slate-900 mb-4">Adresses</h3>
            {% set prototype %}
                <div class="bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200 relative group" data-form-collection-target="element">
                    <button type="button" class="absolute top-2 right-2 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity" data-action="form-collection#removeElement">
                        <twig:ux:icon name="tabler:trash" class="w-5 h-5" />
                    </button>
                    <div class="space-y-3">
                        {{ form_row(form.adresses.vars.prototype.Title, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                        <div class="grid grid-cols-[100px_1fr] gap-2">
                            {{ form_row(form.adresses.vars.prototype.number, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                            {{ form_row(form.adresses.vars.prototype.street, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                             {{ form_row(form.adresses.vars.prototype.ZipCode, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                             {{ form_row(form.adresses.vars.prototype.Country, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                        </div>
                    </div>
                </div>
            {% endset %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" 
                 data-controller="form-collection"
                 data-form-collection-index-value="{{ form.adresses|length > 0 ? form.adresses|last.vars.name + 1 : 0 }}"
                 data-form-collection-prototype-value="{{ prototype|e('html_attr') }}">
                
                {% for adress in form.adresses %}
                    <div class="bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200 relative group"
                         data-form-collection-target="element">
                        <button type="button" 
                                class="absolute top-2 right-2 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                                data-action="form-collection#removeElement">
                            <twig:ux:icon name="tabler:trash" class="w-5 h-5" />
                        </button>
                        <div class="space-y-3">
                            {{ form_row(adress.Title, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                            <div class="grid grid-cols-[100px_1fr] gap-2">
                                {{ form_row(adress.number, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                                {{ form_row(adress.street, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                {{ form_row(adress.ZipCode, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                                {{ form_row(adress.Country, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm'}}) }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
                
                {# Placeholder pour ajouter une adresse - Action JS nécessaire #}
                <button type="button" class="flex items-center justify-center p-6 border-2 border-dashed border-slate-300 rounded-lg hover:border-cyan-500 hover:bg-cyan-50 transition-colors text-slate-500 hover:text-cyan-600"
                        data-action="form-collection#addElement">
                    <twig:ux:icon name="tabler:plus" class="w-6 h-6 mr-2" />
                    Ajouter une adresse
                </button>
            </div>
             <div class="hidden" data-prototype="{{ prototype|e('html_attr') }}"></div>
        </div>

        {# TAB 2: Description #}
        <div class="hidden" id="description" role="tabpanel" aria-labelledby="description-tab">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Left Column: Image Upload -->
                <div class="space-y-4">
                     <h3 class="text-lg font-medium text-slate-900">Logo de l'entreprise</h3>
                     {% if vich_uploader_asset(company, 'imageFile') %}
                        <div class="relative w-full h-48 rounded-lg overflow-hidden border border-slate-200 bg-slate-50 flex items-center justify-center mb-2">
                             <img src="{{ vich_uploader_asset(company, 'imageFile') }}" alt="Logo" class="max-w-full max-h-full object-contain">
                        </div>
                    {% else %}
                        <div class="relative w-full h-48 rounded-lg overflow-hidden border border-dashed border-slate-300 bg-slate-50 flex flex-col items-center justify-center mb-2 text-slate-400">
                             <twig:ux:icon name="tabler:photo" class="w-12 h-12 mb-2" />
                             <span class="text-sm">Aucun logo</span>
                        </div>
                    {% endif %}
                    
                    {{ form_row(form.imageFile) }}
                </div>
                
                <!-- Right Column: Description -->
                 <div class="space-y-4">
                    <h3 class="text-lg font-medium text-slate-900">Description</h3>
                    {{ form_row(form.Description, {'attr': {'class': 'flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50', 'rows': 12}}) }}
                 </div>
            </div>
        </div>

        {# TAB 3: Utilisateurs #}
        <div class="hidden" id="users" role="tabpanel" aria-labelledby="users-tab">
             <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-medium text-slate-900">Utilisateurs associés</h3>
                <button type="button" onclick="document.getElementById('invitationModal').classList.remove('hidden')"
                        class="px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 transition-colors text-sm font-medium flex items-center">
                    <twig:ux:icon name="tabler:user-plus" class="w-4 h-4 mr-2" />
                    Inviter un utilisateur
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Nom</th>
                            <th scope="col" class="px-6 py-3">Email</th>
                            <th scope="col" class="px-6 py-3">Rôle</th>
                            <th scope="col" class="px-6 py-3 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in company.Users %}
                            <tr class="bg-white border-b hover:bg-gray-50">
                                <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                    {{ user.username|default('N/A') }}
                                </td>
                                <td class="px-6 py-4">
                                    {{ user.email }}
                                </td>
                                <td class="px-6 py-4">
                                     {% if company.owner == user %}
                                        <span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Propriétaire</span>
                                    {% elseif 'ROLE_ENTREPRISE_ADMIN' in user.roles %}
                                        <span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Admin</span>
                                    {% elseif 'ROLE_ENTREPRISE_USER' in user.roles %}
                                        <span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Utilisateur</span>
                                    {% else %}
                                        <span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Membre</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 text-right">
                                    {% if company.owner and company.owner.id == user.id %}
                                        <span class="text-xs text-slate-400 italic">Non modifiable</span>
                                    {% else %}
                                        <button type="button"
                                                onclick="openEditUserModal({{ user.id }}, '{{ user.username|default(user.email)|e('js') }}', '{{ user.email|e('js') }}', '{{ 'ROLE_ENTREPRISE_ADMIN' in user.roles ? 'ROLE_ENTREPRISE_ADMIN' : 'ROLE_ENTREPRISE_USER' }}')"
                                                class="font-medium text-cyan-600 hover:underline text-sm">
                                            Éditer
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                        {% else %}
                             <tr>
                                <td colspan="4" class="px-6 py-4 text-center text-gray-500">Aucun utilisateur trouvé.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="flex justify-end pt-6 border-t border-gray-200 mt-6 bg-white p-4 rounded-b-lg">
            <twig:Button type="submit">Enregistrer les informations</twig:Button>
        </div>
    </div>
    

    {{ form_end(form) }}

    {# Flash messages #}
    {% for message in app.flashes('success') %}
        <div class="mt-4 p-4 text-sm text-green-800 rounded-lg bg-green-50 border border-green-200" role="alert">
            <span class="font-medium">✓</span> {{ message }}
        </div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="mt-4 p-4 text-sm text-red-800 rounded-lg bg-red-50 border border-red-200" role="alert">
            <span class="font-medium">✗</span> {{ message }}
        </div>
    {% endfor %}

    {# Modal Invitation #}
    <div id="invitationModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-cyan-100 flex items-center justify-center">
                        <twig:ux:icon name="tabler:user-plus" class="w-4 h-4 text-cyan-600" />
                    </div>
                    <h3 class="text-base font-semibold text-slate-900">Inviter un utilisateur</h3>
                </div>
                <button type="button" onclick="document.getElementById('invitationModal').classList.add('hidden')"
                        class="text-slate-400 hover:text-slate-600 transition-colors">
                    <twig:ux:icon name="tabler:x" class="w-5 h-5" />
                </button>
            </div>

            <div class="px-6 py-5">
                <p class="text-sm text-slate-500 mb-5">
                    Un email sera envoyé au candidat avec un lien pour créer son compte et rejoindre <strong>{{ company.name }}</strong>.
                </p>

                {{ form_start(invitationForm, {'attr': {'class': 'space-y-4'}}) }}

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label for="{{ invitationForm.prenom.vars.id }}" class="text-sm font-medium text-slate-700">Prénom</label>
                            {{ form_widget(invitationForm.prenom, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500', 'placeholder': 'Jean'}}) }}
                            <div class="text-xs text-red-500">{{ form_errors(invitationForm.prenom) }}</div>
                        </div>
                        <div class="space-y-1">
                            <label for="{{ invitationForm.nom.vars.id }}" class="text-sm font-medium text-slate-700">Nom</label>
                            {{ form_widget(invitationForm.nom, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500', 'placeholder': 'Dupont'}}) }}
                            <div class="text-xs text-red-500">{{ form_errors(invitationForm.nom) }}</div>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label for="{{ invitationForm.email.vars.id }}" class="text-sm font-medium text-slate-700">Adresse email</label>
                        {{ form_widget(invitationForm.email, {'attr': {'class': 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500', 'placeholder': 'jean.dupont@exemple.com'}}) }}
                        <div class="text-xs text-red-500">{{ form_errors(invitationForm.email) }}</div>
                    </div>

                    <div class="bg-slate-50 rounded-lg p-3 text-xs text-slate-500 flex items-start gap-2">
                        <twig:ux:icon name="tabler:info-circle" class="w-4 h-4 flex-shrink-0 mt-0.5 text-slate-400" />
                        <span>L'utilisateur sera créé avec les rôles <strong>Entreprise</strong> et <strong>Utilisateur Entreprise</strong>. Le lien expire dans 7 jours.</span>
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="document.getElementById('invitationModal').classList.add('hidden')"
                                class="flex-1 px-4 py-2 border border-slate-200 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                            Annuler
                        </button>
                        <button type="submit"
                                class="flex-1 px-4 py-2 bg-cyan-600 text-white rounded-md text-sm font-medium hover:bg-cyan-700 transition-colors flex items-center justify-center gap-2">
                            <twig:ux:icon name="tabler:send" class="w-4 h-4" />
                            Envoyer l'invitation
                        </button>
                    </div>

                {{ form_end(invitationForm) }}
            </div>
        </div>
    </div>

    {# Modal Édition Utilisateur #}
    <div id="editUserModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
                        <twig:ux:icon name="tabler:user-edit" class="w-4 h-4 text-blue-600" />
                    </div>
                    <h3 class="text-base font-semibold text-slate-900">Modifier l'utilisateur</h3>
                </div>
                <button type="button" onclick="closeEditUserModal()"
                        class="text-slate-400 hover:text-slate-600 transition-colors">
                    <twig:ux:icon name="tabler:x" class="w-5 h-5" />
                </button>
            </div>

            <div class="px-6 py-5">
                {# Infos utilisateur (lecture seule) #}
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg mb-5">
                    <div class="w-10 h-10 rounded-full bg-slate-300 flex items-center justify-center flex-shrink-0">
                        <span id="editUserInitial" class="text-sm font-bold text-slate-700"></span>
                    </div>
                    <div class="min-w-0">
                        <p id="editUserName" class="text-sm font-semibold text-slate-900 truncate"></p>
                        <p id="editUserEmail" class="text-xs text-slate-500 truncate"></p>
                    </div>
                </div>

                <form id="editUserForm" method="POST" action="" class="space-y-4">
                    <input type="hidden" name="_token" value="{{ csrf_token('edit_user') }}">

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-700">Rôle dans l'entreprise</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="relative flex cursor-pointer rounded-lg border border-slate-200 p-4 hover:border-blue-300 transition-colors has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="role" value="ROLE_ENTREPRISE_USER" id="role_user" class="sr-only" />
                                <div class="flex items-start gap-3">
                                    <div class="mt-0.5 w-4 h-4 rounded-full border-2 border-slate-300 flex items-center justify-center flex-shrink-0" id="radio_user_indicator">
                                        <div class="w-2 h-2 rounded-full bg-blue-500 hidden" id="radio_user_dot"></div>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-900">Utilisateur</p>
                                        <p class="text-xs text-slate-500 mt-0.5">Accès standard</p>
                                    </div>
                                </div>
                            </label>
                            <label class="relative flex cursor-pointer rounded-lg border border-slate-200 p-4 hover:border-blue-300 transition-colors has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="role" value="ROLE_ENTREPRISE_ADMIN" id="role_admin" class="sr-only" />
                                <div class="flex items-start gap-3">
                                    <div class="mt-0.5 w-4 h-4 rounded-full border-2 border-slate-300 flex items-center justify-center flex-shrink-0" id="radio_admin_indicator">
                                        <div class="w-2 h-2 rounded-full bg-blue-500 hidden" id="radio_admin_dot"></div>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-900">Admin</p>
                                        <p class="text-xs text-slate-500 mt-0.5">Gestion étendue</p>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="closeEditUserModal()"
                                class="flex-1 px-4 py-2 border border-slate-200 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                            Annuler
                        </button>
                        <button type="submit"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                            <twig:ux:icon name="tabler:check" class="w-4 h-4" />
                            Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openEditUserModal(userId, userName, userEmail, currentRole) {
            document.getElementById('editUserName').textContent = userName;
            document.getElementById('editUserEmail').textContent = userEmail;
            document.getElementById('editUserInitial').textContent = userName.charAt(0).toUpperCase();

            const form = document.getElementById('editUserForm');
            form.action = '/business/user/' + userId + '/edit';

            const radioUser = document.getElementById('role_user');
            const radioAdmin = document.getElementById('role_admin');

            if (currentRole === 'ROLE_ENTREPRISE_ADMIN') {
                radioAdmin.checked = true;
            } else {
                radioUser.checked = true;
            }

            document.getElementById('editUserModal').classList.remove('hidden');
        }

        function closeEditUserModal() {
            document.getElementById('editUserModal').classList.add('hidden');
        }

        document.getElementById('editUserModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditUserModal();
        });

        document.getElementById('invitationModal').addEventListener('click', function(e) {
            if (e.target === this) document.getElementById('invitationModal').classList.add('hidden');
        });
    </script>

    <script>
        function changeTab(tabId) {
            document.querySelectorAll('[role="tabpanel"]').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('[role="tab"]').forEach(el => {
                el.classList.remove('text-cyan-600', 'border-cyan-600');
                el.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                el.setAttribute('aria-selected', 'false');
            });
            const activeTab = document.getElementById(tabId + '-tab');
            activeTab.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
            activeTab.classList.add('text-cyan-600', 'border-cyan-600');
            activeTab.setAttribute('aria-selected', 'true');

            const url = new URL(window.location);
            url.searchParams.set('tab', tabId);
            history.replaceState(null, '', url);
        }

        // Restore active tab from URL param on page load
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab');
            const validTabs = ['general', 'description', 'users'];
            if (tab && validTabs.includes(tab)) {
                changeTab(tab);
            }
        });
    </script>
{% endblock %}
