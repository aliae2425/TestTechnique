{% if field.value is empty %}
    <span class="badge badge-secondary">Aucun historique</span>
{% else %}
    <div data-controller="searchable-table ajax-modal">
        <div class="mb-3">
            <input type="text" 
                   class="form-control form-control-sm" 
                   placeholder="Rechercher..." 
                   data-searchable-table-target="input"
                   data-action="input->searchable-table#search">
        </div>

        <table class="table table-sm table-hover">
            <thead>
                <tr>
                    <th style="cursor: pointer" data-action="click->searchable-table#sort">
                        Titre <span class="sort-icon text-muted small">⇅</span>
                    </th>
                    <th style="cursor: pointer" data-action="click->searchable-table#sort">
                        Date <span class="sort-icon text-muted small">⇅</span>
                    </th>
                    <th style="cursor: pointer" data-action="click->searchable-table#sort">
                        Score <span class="sort-icon text-muted small">⇅</span>
                    </th>
                    <th>Detail</th>
                </tr>
            </thead>
            <!-- Single tbody for simpler sorting with search controller, since we don't have nested rows anymore -->
            <tbody data-searchable-table-target="group">
                {% for session in field.value %}
                    <tr>
                        <td>{{ session.quizTemplate.Titre|default('Quiz supprimé') }}</td>
                        <td>{{ session.startAt ? session.startAt|date('d/m/Y H:i') : 'N/A' }}</td>
                        <td>
                            {% if session.finalScore is not null %}
                                <span class="badge {{ session.finalScore >= 50 ? 'badge-success' : 'badge-danger' }}">
                                    {{ session.finalScore }}%
                                </span>
                            {% else %}
                                <span class="badge badge-warning">En cours</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn btn-sm btn-link text-decoration-none text-dark" 
                                    type="button" 
                                    data-action="click->ajax-modal#open"
                                    data-url="{{ path('admin_ajax_quiz_session_details', {id: session.id}) }}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

         <!-- Modal -->
        <div class="modal fade" tabindex="-1" aria-hidden="true" data-ajax-modal-target="modal">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Détails de la session</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" data-ajax-modal-target="modalBody">
                        <!-- Content loaded via Ajax -->
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
